/*! whitewater-player - v1.0.0 - 2016-06-22 */

function Whitewater(a,b,c){"use strict";function d(){this.canvas.play=this.play,this.canvas.pause=this.pause,this.canvas.playpause=this.playpause,this.canvas.stop=this.stop}function e(){if(B++,B>I.imagesRequired){this.canvas.setAttribute("data-state","ready"),this.state="ready";var a=new CustomEvent("whitewaterload",g.call(this));this.canvas.dispatchEvent(a),c.autoplay&&this.play()}}function f(){var a=null;a=0===this.currentFrame?C:h(F[this.currentFrame-1]),y.drawImage(a,0,0),this.currentFrame++,q.call(this)}function g(){return{detail:{video:this,currentFrame:this.currentFrame,progress:this.progress,timestamp:this.timestamp,maxTime:this.maxTime,state:this.state,secondsElapsed:this.secondsElapsed},bubbles:!0,cancelable:!1}}function h(a){var b=document.createElement("canvas");b.width=I.videoWidth,b.height=I.videoHeight;for(var c=0;c<a.length;c++){var d=a[c][0],e=a[c][1],f=v(d),g=e*I.blockSize;if(b.getContext("2d").drawImage(D[z],A.x*I.blockSize,A.y*I.blockSize,g,I.blockSize,f[0]*I.blockSize,f[1]*I.blockSize,g,I.blockSize),A.x+=e,A.x>=I.sourceGrid&&(A.x=0,A.y++,A.y>=I.sourceGrid&&(A.y=0,z++,z>=D.length)))throw"imageIndex exceeded diffImages.length\n\nmapLength = "+a.length+"\nj = "+c}return b}function i(){var a=this;C.addEventListener("load",function(){e.call(a),p.call(a)},!1),C.src=H+"first."+I.format;for(var b=1;b<=I.imagesRequired;b++){var c=new Image;c.addEventListener("load",e.bind(this),!1),b>99?c.src=H+"diff_"+b+"."+I.format:b>9?c.src=H+"diff_0"+b+"."+I.format:c.src=H+"diff_00"+b+"."+I.format,D.push(c)}}function j(a){function b(){try{G=JSON.parse(f.responseText)}catch(b){return void this.constructor._throwError(b)}s.call(this),r.call(this);var d=null,g=function(){function a(a){for(var b,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0;a.length;)b=c.indexOf(a.charAt(0)),a=a.substr(1),d*=64,d+=b;return d}var b=!1;return b=!0,onmessage=function(b){for(var c=b.data,d=[],e=0;e<c.length;e++){var f=c[e],g=[];if(""!==f)for(var h=f.match(/.{1,5}/g),i=h.length,j=0;j<i;j++){var k=a(h[j].substr(0,3)),l=a(h[j].substr(3,2));g.push([k,l])}d.push(g)}postMessage(d)},b};if(g()){var h=window.URL||window.webkitURL,i=new Blob(["("+g.toString()+")()"],{type:"text/javascript"});d=new Worker(h.createObjectURL(i))}else d=new Worker("whitewater.worker.js");d.postMessage(G.frames),d.onmessage=function(b){F=b.data,d.terminate();for(var f=0;f<a.length;f++)a[f]();c.controls&&o.call(e)}}function d(){try{throw this.constructor.errors.MANIFEST}catch(a){return void this.constructor._throwError(a)}}var e=this,f=new XMLHttpRequest;f.open("GET",H+"manifest.json",!1),f.addEventListener("load",b.bind(this),!1),f.addEventListener("error",d.bind(this),!1),f.send()}function k(){z=0,A.x=0,A.y=0,this.currentFrame=0,y.clearRect(0,0,I.videoWidth,I.videoHeight)}function l(){if(!(a instanceof HTMLCanvasElement))throw this.constructor.errors.CANVAS;this.canvas=a,y=this.canvas.getContext("2d")}function m(){if("string"!=typeof b)throw this.constructor.errors.PATH;H=b,"/"!==b.substr(-1)&&(H+="/")}function n(){if(c){var a=1;c.speed&&c.speed<1&&(a=c.speed),c={loop:c.loop||!1,autoplay:c.autoplay||!1,controls:c.controls||!1,speed:a}}}function o(){var a=this.canvas;"boolean"!=typeof c.controls&&(a=c.controls);var b=u();a.addEventListener(b,this.playpause)}function p(){var a=C.src,b=this.canvas.style.paddingTop;this.canvas.style.background="transparent url("+a+") no-repeat center "+b,this.canvas.style.backgroundSize="contain"}function q(){this.progress=x(this.currentFrame/I.frameCount*100,3);var a=this.currentFrame/I.framesPerSecond;this.timestamp=w(a),this.secondsElapsed=x(a,3);var b=new CustomEvent("whitewaterprogressupdate",g.call(this));this.canvas.dispatchEvent(b)}function r(){this.canvas.setAttribute("width",I.videoWidth+"px"),this.canvas.setAttribute("height",I.videoHeight+"px")}function s(){var a="";switch(G.format){case"JPEG":a="jpg";break;case"PNG":a="png";break;case"GIF":a="gif";break;default:a="jpg"}I={videoWidth:G.videoWidth,videoHeight:G.videoHeight,imagesRequired:G.imagesRequired,frameCount:G.frameCount-1,blockSize:G.blockSize,sourceGrid:G.sourceGrid,framesPerSecond:Math.round(G.framesPerSecond),format:a};var b=I.frameCount/I.framesPerSecond;this.maxTime=w(b)}function t(){try{l.call(this),m(),n();var a=[i.bind(this),d.bind(this)];j.call(this,a)}catch(b){return void this.constructor._throwError(b)}}function u(){var a="ontouchstart"in document.documentElement,b=a?"touchend":"mouseup";return b}function v(a){var b=[],c=Math.ceil(I.videoWidth/I.blockSize);return b=a<c?[a,0]:[a%c,Math.floor(a/c)]}function w(a){var b=Math.floor(a/60),c=Math.floor(a%60),d=Math.floor(a%60%1*1e3);return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10?d="00"+d:d<100&&(d="0"+d),b+":"+c+"."+d}function x(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}var y=null,z=0,A={x:0,y:0},B=0,C=new Image,D=[],E=null,F=null,G=null,H="",I={};this.state="loading",this.currentFrame=0,this.progress=0,this.timestamp="00:00.000",this.maxTime="00:00.000",this.secondsElapsed=0,Whitewater.supported&&t.call(this);var J=this;this.pause=function(){if("paused"!==J.state){J.canvas.setAttribute("data-state","paused"),J.state="paused";var a=new CustomEvent("whitewaterpause",g.call(J));J.canvas.dispatchEvent(a),cancelAnimationFrame(E)}},this.play=function(){function a(b){var d=b-h;if(E=requestAnimationFrame(a),d>=e){if(J.currentFrame<I.frameCount+1)f.call(J);else if(c.loop){k.call(J),f.call(J);var i=new CustomEvent("whitewaterloop",g.call(J));J.canvas.dispatchEvent(i)}else{J.stop(),J.canvas.setAttribute("data-state","ended"),J.state="ended";var j=new CustomEvent("whitewaterend",g.call(J));J.canvas.dispatchEvent(j)}var l=d-e;h=b-l}}if("playing"!==J.state){"ended"===J.state&&k.call(J),J.canvas.setAttribute("data-state","playing"),J.state="playing";var b=new CustomEvent("whitewaterplay",g.call(J));J.canvas.dispatchEvent(b);var d=1/I.framesPerSecond*1e3,e=x(d/c.speed,2),h=window.performance.now();a()}},this.playpause=function(){"playing"===J.state?J.pause():"loading"!==J.state&&J.play()},this.stop=function(){if("ready"!==J.state){J.canvas.setAttribute("data-state","ready"),J.state="ready";var a=new CustomEvent("whitewaterend",g.call(J));J.canvas.dispatchEvent(a),cancelAnimationFrame(E),k.call(J),q.call(J)}}}Whitewater.errors={pre:"Whitewater: ",MISC:"Whatever.",WEBWORKERS:"This browser does not support Web Workers.",BLOBCONSTRUCTOR:"This browser does not support the Blob() constructor.",CANVAS:'"canvas" must be a valid HTML canvas element.',PATH:'"path" must be a path to a directory containing a manifest.json file',MANIFEST:"A manifest.json file could not be found."},Whitewater._checkSupport=function(){try{if(window.Blob){if(window.Worker)return!0;throw this.errors.BLOBCONSTRUCTOR}throw this.errors.WEBWORKERS}catch(a){return this._throwError(a),!1}},Whitewater._throwError=function(a){console.warn(this.errors.pre+a)},Whitewater.supported=Whitewater._checkSupport();
//# sourceMappingURL=whitewater.min.js.map
